<!DOCTYPE html>
<html>
<meta type-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
    <title>AlphaGo</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
    <div class="top-nav">
        <ul>
            <li class="logo left"></li>
            <li class="left here nav-on"><a href="#">Home</a></li>
            <li class="left"><a href="rule.html">Rules</a></li>
            <li class="left"><a href="team.html">Team</a></li>
            <li class="left"><a href="playGameLocal.html">Play Game</a></li>
            <div class="right sign-nav">
                <form id="" class="">
                    <input placeholder="User Name" type="text" name="userName">&nbsp;
                    <input placeholder="Password" type="password" name="pw">
                    <button style='background: url("img/signin-nav.png")'></button>
                </form>
            </div>
        </ul>
    </div><br/>
    <div class="canvas fc-b" onload="init()">
		<div id="result">
		</div>
	</div>
	<div class="top-nav">
		<ul>
			<li class="left"><button id="start">START</button></li>
			<li class="left"><button id="move">move</button></li>
			<li class="left"><button id="pass">pass</button></li>
		</ul>
</body>
<script type="text/javascript" src="js/jquery-2.2.2.min.js"></script>
<script type="text/javascript" src="js/style.js"></script>
<script type="text/javascript" src="js/svgFactory.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	window.gameID = window.location.href.split("?gameID=")[1];
	if(gameID){
		$("#start").attr("id", "resign").text("Resign");
	}
	console.log("ready.");
	$("#start").click(function(){
		$.post(
			"/match/startHotSeat",
			{ "boardSize" : 9 },
			function(data){
				window.location.href=("/index.html?gameID="+data);
				console.log("got data.:\n\t"+data);
			}
		);
	});
	$("#resign").click(function(){
		if(gameID){
			$.ajax({
			url: "/game/"+gameID+"/logout",
			success: function(data){
				console.log(JSON.stringify(data));
				window.location.href=("/index.html");
			},
			dataType: "json"});
		}
	});
	$("#move").click(function(){
		$("#result").text("move");
	});
	$("#pass").click(function(){
		$("#result").text("pass");
	});
});

function pollData(){
	setTimeout(function(){
		if(gameID){
			$.ajax({
			url: "/game/"+gameID,
			success: function(data){
				//$("#result").text(JSON.stringify(data));
				drawBoard(data);
				pollData();
			},
			dataType: "json"});
		}
	}, 4000);
}

function drawBoard(state){
    // everything else should adapt to an adjustable
    // height and width.
    console.log("Board Size: ", state.BoardSize);
    var unitSize;
    if(state.BoardSize <= 10){
        unitSize = 100;
    }else if(state.BoardSize > 10 && state.BoardSize <= 15){
        unitSize = 70;
    }else {
        unitSize = 50;
    }
    var canvas = $("#result");
    var W = state.BoardSize * unitSize + unitSize, H = state.BoardSize * unitSize + unitSize;
    canvas.css("height", H );
    canvas.css("width", W );

    // Change the height and width of the board here...
    // The actual SVG element to add to.
    // we make a jQuery object out of this, so that
    // we can manipulate it via calls to the jQuery API.
    var svg = $(makeSVG(W, H));
    var i, j;
    var temp = 0;

    //draw every unit rectangle
    for(i = 0; i <= W; i+=unitSize){
        for(j = 0; j <= H; j+=unitSize ){
            //if-else comment: make the color different in the different unit.
            if((i/unitSize)%2 == 0 && (j/unitSize)%2 == 0 || (i/unitSize)%2 == 1 && (j/unitSize)%2 == 1){
                svg.append($(makeRectangle(i, j, unitSize, unitSize, 'burlywood')));
            }else {
                svg.append($(makeRectangle(i, j, unitSize, unitSize, 'darkkhaki')));
            }
        }
    }

    for(var k = unitSize; k < W; k+=unitSize){
        svg.append(makeLine(k, 1, k, W-1));
    }

    for(var a = unitSize; a < H; a+=unitSize){
        svg.append(makeLine(1, a, H-1, a));
    }

    // append the svg object to the canvas object.
    var board = state.Board[0];

    for(var i = 0; i < state.BoardSize; i++){
        for (var j = 0; j < state.BoardSize; j ++){
            if(state.Board[i][j] == 'BLACK'){
                svg.append(makeCircle(i*unitSize + unitSize, j*unitSize + unitSize, unitSize/2.5, 'BLACK'));
            }else if(state.Board[i][j] == 'WHITE'){
                svg.append(makeCircle(i*unitSize + unitSize, j*unitSize + unitSize, unitSize/2.5, 'WHITE'));
            }else{
				svg.append(makeCircle(i*unitSize + unitSize, j*unitSize + unitSize, unitSize/2.5, 'GREY'));
			}
        }
    }

    canvas.append(svg);
}

pollData();
</script>
</html>
